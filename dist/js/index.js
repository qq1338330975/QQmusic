var len,timer,root=window.player,index=0,Audio=root.audioManager,change=new root.change,chageIndex=change.changeIndex,changeplay=change.changePlay,changelike=change.changeLike,changetime=change.changetime,dataDeg=$(".img-box").attr("data-deg"),handleTime=root.HandleTime,duration=0;function getData(e){$.ajax({type:"GET",url:e,success:function(e){$(".chage-list li:nth-of-type(1)").css("color","red"),void 0,handleTime.totalTime(e[0].duration,"last"),duration=e[0].duration,Audio.getAudio(e[0].audio),len=e.length,bindEvent(e),bindTouchEvent(e),root.rander(e[0]),root.randerlist(e),root.discTime=0},error:function(){void 0}})}function bindEvent(t){$(".prev").on("click",function(){index=chageIndex(index,len,-1,t,"true")}),$(".next").on("click",function(){index=chageIndex(index,len,1,t,"true")}),$(".like").on("click",function(){changelike(t),$(this).toggleClass("liking")}),$(".play").on("click",function(){$(this).toggleClass("playing"),"pause"==Audio.status?(Audio.play(),rotated(parseInt(dataDeg)),handleTime.playTime(t,root.curTimes)):root.stopTime()}),$(".list").on("click",function(){$(".chage-list").css({transform:"translateY(0)"}).find("span").on("click",function(){$(".chage-list").css({transform:"translateY(100%)"})}),$("ul").on("click",function(e){target=e.target,index=parseInt($(target).attr("index")),chageIndex(index,len,0,t,"false")})})}function bindTouchEvent(n){var a=$(".pro-bottom").offset().left,o=$(".pro-bottom").offset().width;$(".slider").on("touchstart",function(e){Audio.pause(),clearInterval(timer),cancelAnimationFrame(root.frameId)}).on("touchmove",function(e){var t=(e.changedTouches[0].clientX-a)/o;root.curTimes=t*duration,0<t&&t<1&&(handleTime.barrun(n,t),handleTime.totalTime(root.curTimes,"frist"))}).on("touchend",function(e){var t=(e.changedTouches[0].clientX-a)/o;root.curTimes=t*duration,handleTime.barrun(n,t),handleTime.totalTime(root.curTimes,"frist"),Audio.playTo(root.curTimes,n),Audio.play(),rotated(parseInt(dataDeg)),handleTime.playTime(n,root.curTimes),$(".play").addClass("playing")})}function rotated(e){clearInterval(timer),timer=setInterval(function(){dataDeg=e,e+=2,$(".img-box").attr("data-deg",e),$(".img-box").css({transform:"rotateZ("+e+"deg)",transition:"all 0.1s linear"})},110)}root.times=0,root.rotateChage=function(){"pause"==Audio.status?(clearInterval(timer),dataDeg=0):(clearInterval(timer),rotated(0)),$(".img-box").css({transform:"rotateZ(0deg)",transition:"none"})},$(Audio.audio).on("ended",function(){$(".next").trigger("click")}),getData("../mock/data.json");